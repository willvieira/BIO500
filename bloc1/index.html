<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>BIO500</title>
    <meta charset="utf-8" />
    <meta name="author" content="Dominique Gravel" />
    <link href="assets/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="assets/remark-css-0.0.1/hygge.css" rel="stylesheet" />
    <link rel="stylesheet" href="../assets/bio500.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">



class: title-slide, middle

&lt;style type="text/css"&gt;
  .title-slide {
    background-image: url('../assets/img/bg.jpg');
    background-color: #23373B;
    background-size: contain;
    border: 0px;
    background-position: 600px 0;
    line-height: 1;
  }
&lt;/style&gt;

# Séance 1

&lt;hr width="65%" align="left" size="0.3" color="orange"&gt;&lt;/hr&gt;

## Introduction: Méthodes en écologie computationnelle

&lt;hr width="65%" align="left" size="0.3" color="orange" style="margin-bottom:40px;" alt="@Martin Sanchez"&gt;&lt;/hr&gt;

.instructors[
  **BIO500** - Dominique Gravel
]

&lt;img src="../assets/img/logo.png" width="8%" style="margin-top:20px;"&gt;&lt;/img&gt;

---

# Séance 1

- Ces diapositives sont disponibles en [version web](https://econumuds.github.io/BIO500/bloc1/).
- L'ensemble du matériel de cours est disponible sur la page du cours [github](https://github.com/EcoNumUdS/BIO500).

---
class: inverse, center, middle

# Introduction

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# L'importance des réseaux

.center[
  &lt;img src="assets/img/r0.png" height="500px"&gt;&lt;/img&gt;
]

---

# L'importance des réseaux

.center[
  &lt;img src="assets/img/covid.png" height="500px"&gt;&lt;/img&gt;
]

---

# Le Bacon number

.center[
  &lt;img src="assets/img/bacon.jpg" height="500px"&gt;&lt;/img&gt;
]

---
# Le Bacon number

Une hypothèse selon laquelle n'importe quel acteur peut être relié à Kevin Bacon via ses rôles dans 6 films ou moins.

---
# Exemple

- Kevin Bacon a lui-même un Bacon number de 0
- Sean Penn a un Bacon number de 1 pour son rôle dans *Mystic River*
- Madonna a un Bacon number de 2 pour son rôle dans *Shadows and Fog*, dans lequel figurait Camille Saviola, qui a elle-même joué avec Kevin Bacon dans *Queens Logic*

Si le jeu vous amuse, allez consulter le site [The Oracle of Bacon](https://oracleofbacon.org/movielinks.php)

---
# Six degrés de séparation

Le jeu est une parodie du mythe urbain de six degrés de séparation, qui propose que tous les humains sur la terre soient à moins de six degrés de séparation dans une chaine "d'ami à ami".

Kochen a proposé dans les années 50 que "*it is practically certain that any two individuals can contact one another by means of at most two intermediaries. In a [socially] structured population it is less likely but still seems probable. And perhaps for the whole world's population, probably only one more bridging individual should be needed.*"

---
# L'expérience de Milgram

- Inspiré des travaux de Gurevich
- Étude des réseaux sociaux
- Souhait d'évaluer la probabilité que deux personnes sélectionnées au hasard se connaissent

---
# L'expérience de Milgram

- Individus choisis au hasard au Nebraska et au Kansas, et qui devaient rejoindre des personnes à Boston.
- Un paquet était envoyé, incluant des instructions, une lettre ainsi que de l'information sur la personne ciblée à Boston
- Si la personne de départ connaissait directement la cible, elle devait lui envoyer directement la lettre
- Sinon, la personne devait choisir un ami ou une connaissance qui était susceptible de connaître la personne cible
- Une fois rendu à destination, le destinataire envoyait la chaîne de communication au chercheur

---
# Résultats

- 64 lettres sur 296 envoyées sont arrivées à destination
- Le nombre de degrés moyens était entre 5 et 6

---
# Suivi

- L'expérience a été répliquée de nombreuses fois, notamment par Dodds et al. qui ont aussi confirmé un nombre de 6
- Watts et Strogatz (1998) ont élaboré un modèle qui permet d'expliquer les propriétés de petit monde trouvées dans de nombreux réseaux

---
# Le modèle de petits mondes

.center[
  &lt;img src="assets/img/small_world.png" height="500px"&gt;&lt;/img&gt;
]

---
# Les propriétés de petit monde en écologie

.center[
  &lt;img src="assets/img/williams2002.png" height="500px"&gt;&lt;/img&gt;
]

---

# Les propriétés de petit monde en écologie

.center[
  &lt;img src="assets/img/foodweb.png" height="500px"&gt;&lt;/img&gt;
]

---

# Les propriétés de petit monde en écologie

.center[
  &lt;img src="assets/img/cod.png" height="500px"&gt;&lt;/img&gt;
]

---

# Les propriétés de petit monde en écologie

.center[
  &lt;img src="assets/img/pollinisateur.png" height="500px"&gt;&lt;/img&gt;
]

&lt;!-- ---

TODO: MISSING FILE bacteries.png

# Les propriétés de petit monde en écologie

&lt;div style='text-align:center;'&gt;
&lt;img src="assets/img/bacteries.png" height="500px"&gt;&lt;/img&gt;
&lt;/div&gt; --&gt;

---

# Les propriétés de petit monde en écologie

.center[
  &lt;img src="assets/img/csbq.png" height="500px"&gt;&lt;/img&gt;
]

---
# Le projet de session

Est-ce que le réseau de collaborations entre les étudiants du bacc en écologie a les mêmes propriétés que les réseaux écologiques ?

---
class: inverse, center, middle

# La science reproductible

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# L'importance de la reproductibilité.

## Ces situations peuvent survenir lors de votre carrière professionnelle:

**Situation 1.** Un employeur souhaite que vous réalisiez les mêmes analyses 3 ans plus tard sur des données différentes.

**Situation 2.** Vous avez commis une erreur dans votre saisie de données, vous devez reconduire vos analyses.

**Situation 3.** Un des réviseurs de votre article scientifique vous demande de refaire vos analyses en tenant compte d'une nouvelle variable environnementale.

---

# Les étapes du travail d'un biologiste

.center[
  &lt;img src="assets/img/flow_biometrie.png"  width="90%"&gt;&lt;/img&gt;
]

---

# Les étapes du travail d'un biologiste

.center[
&lt;img src="assets/img/flow_bio500.png" width="90%"&gt;&lt;/img&gt;
]

## Certaines étapes intermédiaires sont souvent oubliées.


---

# Discussion

Identification des étapes d'une étude scientifique susceptibles d'influer sur la reproductibilité.


---
class: inverse, center, middle

# Présentation du cours BIO500

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Objectif général

Au terme de ce cours, l'étudiant sera en mesure de réaliser l'ensemble de la  séquence d'une étude d'écologie en respectant les standards de gestion,  d'analyse et de présentation des données. Le cours portera sur la réalisation d'un projet intégrateur, de la collecte des données à la production du rapport final.

---

# Objectifs spécifiques

- Planifier une base de données et la préparation de formulaires pour leur acquisition ;
- Programmer et interroger une base de données relationnelle ;
- Compiler et exécuter un script au moyen de makefile ;
- Maintenir un cahier de laboratoire au moyen de RMarkdown ;
- Représenter visuellement les données au moyen de R ;
- Préparer un rapport d'étude au moyen de LaTeX ;
- Utiliser un système de contrôle de version pour le suivi des modifications sur du code ;
- Porter un regard critique sur la reproductibilité et la transparence d'études scientifiques ;

---

# Contenu du cours

## Bloc 1: Planification de la collecte et organisation des données

- Types de données
- Formulaires de saisie
- Bases de données relationnelles (SQL)
- Requêtes

---

# Contenu du cours

## Bloc 2: Outils pour une science reproductible et transparente

- Système de contrôle de version git
- Le makefile et ses alternatives sur R
- Le cahier de laboratoire RMarkdown

---

# Contenu du cours

## Bloc 3: Visualisation des données

- Les types de graphiques
- Fonctions graphiques de base sur R
- Paramètres graphiques
- Packages R spécialisés

---

# Contenu du cours

## Bloc 4: Communication scientifique au moyen de LaTeX

- Rédaction de rapports et d'articles scientifiques
- Mise en page
- Insertion de figures et tableaux
- Gestion des références
- Utilisation de Beamer pour les présentations

---

# Approche

Les cours vont comprendre une période de présentation entrecoupée d'exercices, suivie d'une discussion générale sur des enjeux de reproductibilité.

Nous progresserons dans l'exécution du travail de session. Le travail sera divisé en étapes et l'évaluation portera sur son intégration.

---

# Évaluation

L'évaluation porte sur la réalisation d'un travail de session (75%), réalisé en équipe de 4 personnes. Le travail sera divisé en 3 étapes réparties au cours de la session. L'évaluation finale (25%) portera sur la rédaction d'un essai de 1500 mots sur les enjeux de reproductibilité en science expérimentale.



---
class: inverse, center, middle

# Projet de session

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Rappel du problème

Est-ce que le réseau de collaboration entre les étudiants est affecté par l'enseignement à distance et les règles de distanciation ?

---

# Pour commencer

En équipe de 4, on vous demande de commencer à planifier une campagne de collecte de données. Commencez par discuter des types de données que vous souhaitez récolter, faites la liste des informations nécessaires pour répondre à la question. Ensuite, établissez un protocole afin de récolter ces données.

---

# Deuxième étape

Préparez un formulaire de saisie de données avec Excel et commencez à le remplir avec les données entre les membres de votre équipe.

---

# Troisième étape

Retour en classe : partage de l'information et harmonisation des formulaires.

---
class: inverse, center, middle

# Lectures et travail pour la semaine prochaine

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---
# Lectures et travail

## Travail

- Prenez le temps de vous familiariser avec la Machine virtuelle Ubuntu.
  - Exemples: Créer des fichiers et des dossiers, changer le fond d'écran, etc.

- Commencez à récolter les données pour le travail de session.

## Lectures

- Baker, M. 2016. Is there a reproducibility crisis ? Nature, 533 : 452:454
- Munafo, M.R. et al. 2017. A manifesto for reproducible science. Nature Human Behaviour 1: 0021
- Open Science Collaboration. 2015. Estimating the reproducibility of psychological science. Science 349 : 943.



---
class: inverse

---
class: title-slide, middle

&lt;style type="text/css"&gt;
  .title-slide {
    background-image: url('../assets/img/bg.jpg');
    background-color: #23373B;
    background-size: contain;
    border: 0px;
    background-position: 600px 0;
    line-height: 1;
  }
&lt;/style&gt;

# Séance 2

&lt;hr width="65%" align="left" size="0.3" color="orange"&gt;&lt;/hr&gt;

## La gestion des données biologiques

&lt;hr width="65%" align="left" size="0.3" color="orange" style="margin-bottom:40px;" alt="@Martin Sanchez"&gt;&lt;/hr&gt;

.instructors[
  **BIO500** - Dominique Gravel
]

&lt;img src="../assets/img/logo.png" width="8%" style="margin-top:20px;"&gt;&lt;/img&gt;

---

# Séance 2

- Ces diapositives sont disponibles en [version web](https://econumuds.github.io/BIO500/cours2/) et en [PDF](./assets/pdf/S2-BIO500.pdf).
- L'ensemble du matériel de cours est disponible sur la page du portail [moodle](https://www.usherbrooke.ca/moodle2-cours/course/view.php?id=12189).

---

# Retour sur la semaine précédente

Quels sont les champs à documenter ?

---
class: inverse, center, middle

# Les données en biologie

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# La collecte de données

.center[
  &lt;img src="assets/img/flow_cours2.png" width="90%"&gt;&lt;/img&gt;
]

---

# Le constat

.pull-left[
  Trop souvent en écologie, les données sont représentées et entreposées dans un format proche des analyses que l'on veut réaliser.

  Par exemple, on utilise souvent une matrice `\(sites \times espèces\)` pour analyser la structure des communautées.

  La question scientifique ne devrait jamais conditionner notre façon de stocker l'information sur un système écologique (données brutes).
]

.pull-right[
  .center[
  &lt;img src="assets/img/matrix.jpg" width="90%"&gt;&lt;/img&gt;
  ]
]

---

# La collecte de données en biologie

## D'abord, qu'est ce qu'une donnée en écologie?


&lt;!-- Présenter qu'est qu'une données biologiques, comme elle est représentée --&gt;
&lt;!-- Qu'est ce qui est représenté en ligne versus en colonne --&gt;


.center[
  &lt;img src="assets/img/data_cube_2n.png" width="100%"&gt;&lt;/img&gt;
]


---

# La collecte de données en biologie

## Le problème de multi-dimensionnalité

.center[
  &lt;img src="assets/img/data_cube_3n.png" width="100%"&gt;&lt;/img&gt;
]


---

# La collecte de données en biologie

## Le problème de multi-dimensionnalité

.center[
  &lt;img src="assets/img/data_cube_4n.png" width="100%"&gt;&lt;/img&gt;
]

---

# La collecte de données en biologie

## **En biologie**, on classifie les données selon 4 dimensions/classes d'information:

1. Environnementale
2. Taxonomique
3. Temporelle
4. Spatial

Au sein de ce cours, nous nous attarderons à la façon de structurer ces données. Les spécificités propres à chacune de ces dimensions seront présentées. D'abord le format des données, puis les types de données.

---
class: inverse, center, middle

#  Le format des données

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

#  Le format des données

.font70[

.pull-left[
  ## &lt;img src="assets/img/green.svg" width="5%"&gt;&lt;/img&gt; Format long


|ID    |esp  | annees| dhp_mm|
|:-----|:----|------:|------:|
|567-1 |acsa |   2010|    460|
|567-2 |acsa |   2010|    100|
|567-3 |acsa |   2010|    120|
|598   |piru |   2011|    380|
|876   |abba |   2014|    160|

- Noms de colonnes courts, sans accents, sans espaces et explicites.
- Attacher les unités au nom de la colonne (si absence de métadonnées).

]

.pull-right[
## &lt;img src="assets/img/red.svg" width="5%"&gt;&lt;/img&gt; Format large


|ID    |esp  | 2010| 2011| 2014|
|:-----|:----|----:|----:|----:|
|567-1 |acsa |  460|   NA|   NA|
|567-2 |acsa |  100|   NA|   NA|
|567-3 |acsa |  120|   NA|   NA|
|598   |piru |   NA|  380|   NA|
|876   |abba |   NA|   NA|  160|
- Privilégier le format long
- Une ligne = une observation
]]

---

#  Le format des données: tableaux

## &lt;img src="assets/img/green.svg" width="20px"&gt;&lt;/img&gt; Un tableau doit contenir un type d'information
.font70[
.pull-left[
  
  |ID_plot | ID_arbre| ID_multi|esp  | annees| dhp_mm|
  |:-------|--------:|--------:|:----|------:|------:|
  |A       |      567|        1|acsa |   2010|    460|
  |A       |      567|        2|acsa |   2010|    100|
  |A       |      567|        3|acsa |   2010|    120|
  |B       |      598|       NA|piru |   2011|    380|
  |B       |      876|       NA|abba |   2014|    160|
]

.pull-right[
  
  |ID_plot | annees|variable     | valeur|
  |:-------|------:|:------------|------:|
  |A       |   2010|pp_tot_mm    |    880|
  |B       |   2011|pp_tot_mm    |    560|
  |B       |   2014|pp_tot_mm    |    900|
  |A       |   2010|temp_max_deg |     24|
  |B       |   2011|temp_max_deg |     26|
  |B       |   2014|temp_max_deg |     28|

  - Si l'on veut ajouter des données sur le climat, on ajoutera un nouveau tableau.
]]

---

#  Le format des données: colonnes

## &lt;img src="assets/img/green.svg" width="20px"&gt;&lt;/img&gt; Ne pas agréger l'information dans une seule colonne

.font70[
.pull-left[
  
  |ID_arbre |esp  | annees| dhp_mm|
  |:--------|:----|------:|------:|
  |567-1    |acsa |   2010|    460|
  |567-2    |acsa |   2010|    100|
  |567-3    |acsa |   2010|    120|
  |598      |piru |   2011|    380|
  |876      |abba |   2014|    160|

  - Une colonne = une information
]

.pull-right[
  
  |ID_arbre |ID_multi |esp  | annees| dhp_mm|
  |:--------|:--------|:----|------:|------:|
  |567      |1        |acsa |   2010|    460|
  |567      |2        |acsa |   2010|    100|
  |567      |3        |acsa |   2010|    120|
  |598      |NA       |piru |   2011|    380|
  |876      |NA       |abba |   2014|    160|
]
]

---

#  Le format des données: colonnes

&lt;span style="color:rgb(194, 0, 0);"&gt; Important:&lt;/span&gt; votre fichier de données brutes (destiné au stockage à long terme) ne doit pas contenir de champ calculé (c.a.d. une nouvelle colonne avec une moyenne, etc..)


---
class: inverse, center, middle

# Les types de données

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

#  Les types de données en informatique

## **En informatique**, on distingue plusieurs types de données:

| Appelation                | Type                 | Valeurs     | Taille           |
|---------------------------|----------------------|-------------|------------------|
| `BOLEAN`                  | Boléen               | vrai/faux   | 1 octet          |
| `INTEGER`                 | Entiers              | -998, 123   | 1 à 4 octets     |
| `DOUBLE`, `FLOAT`, `REAL` | Nombres réels        | 9.98, -4.34 | 4 à 8 octets     |
| `CHAR`,`VARCHAR`          | Chaine de caractères | lapin       | n x 1 à 8 octets |
| `TIMESTAMP`,`DATE`,`TIME` | Dates et heures      | 1998-02-16  | 4 à 8 octets     |


- Ce sont ces types qui seront utilisés pour entreposer nos données.
- Le choix d'un type approprié permet de réduire la taille du fichier de données.
- Il est *TRES IMPORTANT* de bien définir les types et de les utiliser rigoureusement.

---

# Les données temporelles

La plupart des languages/programmes disposent d'un type `TIMESTAMP`, `DATE` et `TIME` pour représenter une donnée temporelle.

On utilisera préférablement la norme [ISO8601](https://fr.wikipedia.org/wiki/ISO_8601) pour représenter ces données.

  - `TIMESTAMP` (Heure et temps): `YYYY-MM-ddThh:mm:ss`. *ex. `1977-04-22T01:00:00-05:00` ou `1977-04-22T06:00:00Z`*
  - `DATE`: `YYYY-MM-dd`. *ex. 1997-04-22*
  - `TIME`: `HH:mm:ss` dans un systéme de 24 heures. *ex. 01:30:00.*

Gardez à l'esprit que vos données pourraient être réutilisées à travers le monde.


---

# Les données taxonomiques

*Un exemple avec l'érable à sucre*

.pull-left[
  .small[
  **Selon vous quelle option est la meilleure?**

  
  |Option                             |Exemple        |
  |:----------------------------------|:--------------|
  |1. Code spécifique à l'étude       |ACSA           |
  |2. Code du ministère               |ERS            |
  |3. Genre et espèce                 |Acer saccharum |
  |4. Nom vernaculaire                |Érable à sucre |
  |5. Numéro Taxonomique (TSN - ITIS) |28731          |
  ]
]

.pull-right[
  .center[
  &lt;img src="assets/img/acsa.jpg" height="450px"&gt;&lt;/img&gt;
  ]
]

---

# Les données taxonomiques

*Un exemple avec l'érable à sucre*

.pull-left[
  .small[
  
  |Option                             |Exemple        |
  |:----------------------------------|:--------------|
  |1. Code spécifique à l'étude       |ACSA           |
  |2. Code du ministère               |ERS            |
  |3. Genre et espèce                 |Acer saccharum |
  |4. Nom vernaculaire                |Érable à sucre |
  |5. Numéro Taxonomique (TSN - ITIS) |28731          |
  ]
]

.pull-right[
  .small[
  &gt;- &lt;img src="assets/img/red.svg" width="15px"&gt;&lt;/img&gt; **Option 1 et 2:** Doit être associé à des métadonnées. Risque de perte du fichier attaché.

  &gt;- &lt;img src="assets/img/red.svg" width="15px"&gt;&lt;/img&gt; **Option 3:** Le genre et l'espèce peuvent changer à travers le temps.

  &gt;- &lt;img src="assets/img/red.svg" width="15px"&gt;&lt;/img&gt; **Option 4:** Le nom vernaculaire des espèces est le pire choix. Le nom vernaculaire est propre à un pays, à une région géographique, à une culture/dialecte.
  ]
]

---

# Les données taxonomiques

*Un exemple avec l'érable à sucre*

.pull-left[
  .small[
  
  |Option                             |Exemple        |
  |:----------------------------------|:--------------|
  |1. Code spécifique à l'étude       |ACSA           |
  |2. Code du ministère               |ERS            |
  |3. Genre et espèce                 |Acer saccharum |
  |4. Nom vernaculaire                |Érable à sucre |
  |5. Numéro Taxonomique (TSN - ITIS) |28731          |
  ]
]

.pull-right[
&gt;- &lt;img src="assets/img/green.svg" width="15px"&gt;&lt;/img&gt; **Option 5:** Cette option couplée à l'option 3, est le meilleur choix.
]

---

# Les données taxonomiques

## On privilégie généralement l'utilisation de code d'espèce standardisée:

1. [ITIS](https://www.itis.gov/)
2. [VASCAN](http://data.canadensys.net/vascan/search?lang=fr) (Plantes vasculaires du Canada)
3. [NCBI](https://www.ncbi.nlm.nih.gov/)
4. [BOLD](http://www.boldsystems.org/index.php/TaxBrowser_Home) (Projet code barre)

**Avantage:** Chacune de ces institutions/infrastructures nous permet de valider et retirer l'ensemble de la classification taxonomique d'une espèce à partir de son code.
Même si l'identifiant change (nouvelle classification), nous serons en mesure de trouver le nouvel identifiant taxonomique à partir de l'ancien.

**Exemple:** [TSN - 28731](https://www.itis.gov/servlet/SingleRpt/SingleRpt?search_topic=TSN&amp;search_value=28731#null)

---

# Les données spatiales

- **Ce qu'il est important de savoir:** des coordonnées spatiales sans système de projection ne veulent strictement rien dire.
- Ainsi, lorsque l'on entrepose des données spatiales, trois colonnes doivent être représentées:
  - La coordonnée en X
  - La coordonnée en Y
  - La projection écrite en texte (voir votre GPS), ou préférablement l'identifiant unique de la projection.

---

# Les données spatiales

## Il existe plus de [65 familles de projections géographiques](https://en.wikipedia.org/wiki/List_of_map_projections) pour représenter des coordonnées sur la planète, en voici 3 des plus connues:

.center[
  &lt;img src="assets/img/proj.png" height="200px"&gt;&lt;/img&gt;
]

- Il est important de choisir un bon système de projection pour minimiser la déformation spatiale (surtout à nos latitudes)

- À nos latitudes, on privilégiera l'utilisation d'une projection conique. Les ministères du Québec conseillent généralement l'utilisation d'une [projection conique conforme de Lambert](https://fr.wikipedia.org/wiki/Projection_conique_conforme_de_Lambert).

---

#  L'absence de données

## On peut représenter l'absence de données de plusieurs façons:

- Laisser la cellule vide (`NULL`)
- Mettre un `NA` (*Not Available*)
- Mettre un `0`
- Mettre `-9999` dans une colonne numérique

## Selon vous, quel est le choix le plus approprié ?

---

#  Le format des données

## On peut représenter l'absence de données de plusieurs façons:

- Laisser la cellule vide: montre que l'information n'a pas été saisie (un oublie)

&gt;- Mettre un `NA` (*Not Available*): Montre que l'information est réellement absente (car le NA est saisi par un humain).

&gt;- &lt;span style="text-decoration: line-through;"&gt; Mettre un `0` &lt;/span&gt;: **JAMAIS** (empêche la distinction entre un vrai d'un faux 0, influence la moyenne)

&gt;- Mettre `-9999` dans une colonne numérique: Ce choix peut être utilisé seulement pour les jeux de données très importants (centaine de Megas-octet), et doit être référencé dans les métadonnées.


---

# Choisir le bon type et format de données

Si l'on ne choisit pas le type de données approprié, cela aura diverses conséquences:

- Des problèmes de performance (ex. : il est plus rapide de faire une recherche sur un nombre que sur une chaîne de caractères)
- Un comportement contraire à celui attendu (ex. : trier sur un nombre stocké comme tel, ou sur un nombre stocké comme une chaîne de caractères ne donnera pas le même résultat)
- L'impossibilité d'utiliser des fonctionnalités propres à un type de données (ex. : stocker une date comme une chaîne de caractères vous prive des nombreuses fonctions temporelles disponibles).

&lt;!-- Point supplémentaire pour les avancées: - Un gaspillage de mémoire (ex. : si vous stockez de toutes petites données dans une colonne faite pour stocker de grosses quantités de données) --&gt;

---

## Pour en savoir davantage:

- [Broman KW, Woo K (2017) Data organization in spreadsheets. The American Statistician.](http://www.tandfonline.com/doi/abs/10.1080/00031305.2017.1375989)
- [Hart EM, Barmby P, LeBauer D, Michonneau F, Mount S, Mulrooney P, et al. (2016) Ten Simple Rules for Digital Data Storage. PLoS Comput Biol](http://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005097)

---

# Retour sur le travail de session

Définissez les types de données pour les différents champs

---
class: inverse, center, middle

# Entreposer et archiver les données écologiques

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Où sommes-nous?

.center[
  &lt;img src="assets/img/flow_bio.png" width="90%"&gt;&lt;/img&gt;
]

---

# Pourquoi bien entreposer ses données?

.center[
  &lt;img src="assets/img/data_trends.jpg" height="500px"&gt;&lt;/img&gt;
]

[Vines et al., 2013](https://www.nature.com/news/scientists-losing-data-at-a-rapid-rate-1.14416)

---

# Les entrepôts existants

.pull-left[
  1. Les `fichiers textes` comme les CSV, TSV (Format libre et ouvert)
  2. Les `tableurs` comme MS Excel (Logiciel propriétaire), Libre Office Calc. (Logiciel libre)
  3. Les `fichiers hierarchiques/structurés` HDF, NetCDF (Format libre et ouvert)
  4. Les `bases de données relationnelles`
]

.pull-right[
  ## Exemple de fichier CSV

  &lt;img src="assets/img/csv.png" width="80%"&gt;&lt;/img&gt;
]

---

# Les entrepôts existants

.pull-left[
  1. Les `fichiers textes` comme les CSV, TSV (Format libre et ouvert)
  2. Les `tableurs` comme MS Excel (Logiciel propriétaire), Libre Office Calc. (Logiciel libre)
  3. Les `fichiers hierarchiques/structurés` HDF, NetCDF (Format libre et ouvert)
  4. Les `bases de données relationnelles`
]

.pull-right[
## Structure NetCDF

  &lt;img src="assets/img/netcdf.png" width="100%"&gt;&lt;/img&gt;
]
---

# Les données multi-dimensionnelles

.center[
  &lt;img src="assets/img/data_cube_4n.png" width="90%"&gt;&lt;/img&gt;
]

- Il est difficile de stocker les données écologiques dans un tableur (n-2) lorsque les données écologiques ont (n-4).
- Conduit à une redondance dans l'information (par exemple. répéter les coordonnées de l'emplacement du site lorsqu'il est mesuré plusieurs fois).

---

# Les bases de données (BDs) à la rescousse

.center[
  &lt;img src="assets/img/star_eg.png" width="50%"&gt;&lt;/img&gt;
]

- Les BDs permettent de redimensionner ce problème (plusieurs tableaux de n-2 avec des relations) grâce au modèle d'entités-relations.
- Chaque table correspond à une dimension. Les tables sont liées entre elles par des relations. Cette structure est appelée [schéma en étoile](https://en.wikipedia.org/wiki/Star_schema).

---

# Avantages des bases de données

- **Maintenir l'intégrité entre les enregistrements de nos tableaux**. Une observation ne peut être faite sur un site qui n'existe pas.
- **Normaliser et contrôler la qualité des données**. Chaque colonne est un type précis de données. Des contraintes peuvent être appliquées sur chaque colonne.
- **Éviter les redondances dans le stockage de l'information** (obtenir une [forme normale](https://fr.wikipedia.org/wiki/Forme_normale_(bases_de_donn%C3%A9es_relationnelles)), voir la section [Format de donnée du cours 2](https://econumuds.github.io/BIO500/cours2/#10).

---
class: inverse, center, middle

# Conceptualisation d'une base de données &lt;br&gt; en 5 étapes

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

---

# Étape 1. Faire une liste des variables


1. Dresser la liste des informations collectées par les différents groupes.
2. Regrouper les variables communes entre les équipes pour obtenir un format de données conjoint.


---

# Étape 2. Regrouper les variables dans des tables

1. Déterminer les tables/entités:
  - Qu'elles sont les unités d'échantillonnage? Autrement dit, sur quelles entités portent les mesures?
2. Remplir les tables avec les variables identifiées.

À ce stade de la conceptualisation, une table est une entité possédant des attributs. Chaque attribut est une colonne.

---

# Étape 3.

## Établir le type d'association entre les tables

### Le concept d'association

.center[
  &lt;img src="assets/img/card.svg" width="80%"&gt;&lt;/img&gt;
]

---


# Étape 4. Établir les clés primaires et étrangères

## Le concept des clés primaires et des clés étrangères

.center[
  &lt;img src="assets/img/keys_1.svg" width="45%"&gt;&lt;/img&gt;
]

  - Définition : la donnée qui permet d'identifier de manière unique un enregistrement dans une table.
  - Une clé primaire garanti le caractère unique d'un enregistrement (ligne d'une table).
  - Une clé primaire ne peut donc jamais être `NULL`.
  - Une clé primaire peut être composite, une combinaison de colonnes.

---

# Étape 4. Établir les clés primaires et étrangères

1. Déterminer quels sont les attributs/colonnes garantissant le caractère unique d'un enregistrement (ligne d'une table).
2. Déterminer quelles sont les clés étrangères.


---

# Étape 5. Assigner un type de données

Chaque attribut d'une table doit correspondre à un type de données:

.font70[

| Appelation                | Type                 | Valeurs     | Taille           |
|:--------------------------|:---------------------|:------------|:-----------------|
| `BOLEAN`                  | Boléen               | vrai/faux   | 1 octet          |
| `INTEGER`                 | Entiers              | -998, 123   | 1 à 4 octets     |
| `DOUBLE`, `FLOAT`, `REAL` | Nombres réels        | 9.98, -4.34 | 4 à 8 octets     |
| `CHAR`,`VARCHAR`          | Chaine de caractères | lapin       | n x 1 à 8 octets |
| `TIMESTAMP`,`DATE`,`TIME` | Dates et heures      | 1998-02-16  | 4 à 8 octets     |

]

Pour tous les types de données, [voir la documentation SQLite3](https://www.sqlite.org/datatype3.html)

---

# En résumé

## Finalement, qu'est-ce qu'un modèle conceptuel pour une base de données?

Une façon de représenter l'information dans un modèle de type entités-relations où chaque entité (table) possède des attributs (colonnes).

L'étape suivante est de se connecter à la base de données afin de transcrire ce modèle conceptuel en modèle logique (c.a.d compréhensible par l'ordinateur).


---
class: inverse, center, middle

# Les Systèmes de Gestion de Base de Données (SGBDs)

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# La diversité des SGBDs

.pull-left[
  ## Il en existe une multitude:

  .center[
    &lt;img src="assets/img/sgbd.png" width="100%"&gt;&lt;/img&gt;
  ]
]

.pull-right[
  .font90[
  &gt;- Pour créer, interroger, gérer et maintenir des bases de données, on utilisera un **[Système de Gestion de Base de Données](https://fr.wikipedia.org/wiki/Syst%C3%A8me_de_gestion_de_base_de_donn%C3%A9es) (souvent appelé SGBD)**.
  &gt;- Mais ces systèmes disposent tous d'un dénominateur commun: le `langage SQL`
  &gt;- Dans ce cours, nous utiliserons le système de gestion de données `SQLite3` (**Approche fichier de base de données**).
  ]
]

---

# Le langage SQL

## Définition

&gt; Le SQL (Structured Query Language) est le langage des SGBDs. Il permet de communiquer avec une base de données.

---

# Le langage SQL

## Le `SQL` permet de:

1. Créer une base de données (`CREATE DATABASE`).
2. Créer des tables et établir des relations (`CREATE TABLE`).
3. Insérer des données (`INSERT`).
4. Interroger les données par requête (`SELECT`).
5. Supprimer des données ou des tables (`DROP`, `DELETE`).
6. Mettre à jour des données ou des tables (`UPDATE`, `ALTER`).
7. Supprimer la base de données (`DROP DATABASE`).

Chacune de ces commandes est une instruction `SQL` envoyée au serveur pour manipuler et interroger la base de données.

---

# Le langage SQL

## Pour cette séance, nous nous attarderons seulement à:

1. Créer une base de données (`CREATE DATABASE`).
2. Créer des tables et établir des relations (`CREATE TABLE`).
3. Supprimer ou modifier des tables (`DROP TABLE`, `ALTER TABLE`).
4. Supprimer la base de données (`DROP DATABASE`).

Soyez attentifs, car le travail de cette semaine consiste à écrire un script qui permet la création de la base de données (les tables et leurs relations) pour entreposer les données que vous aurez collectées pour le travail de session.


---

# Deux approches avec les bases de données

.pull-left[
  ## Serveur de base de données

  &lt;img src="assets/img/flow_db.png" height="450px"&gt;&lt;/img&gt;
]

.pull-right[
  ## Fichier de base de données

  &lt;img src="assets/img/db_flow2.png" height="450px"&gt;&lt;/img&gt;
]

---

# L'approche: Serveur de base de données

.pull-left[
  .center[
    &lt;img src="assets/img/flow_db.png" height="450px"&gt;&lt;/img&gt;
  ]
]

.pull-right[
  - Le **client** est un logiciel installé sur votre ordinateur.
  - On se sert de ce logiciel pour interagir avec le serveur de base de données présent localement ou à distance.
  - **Avantage:** On peut avoir plusieurs **clients** connectés sur un même serveur (contexte multi-utilisateurs).
]

---

# L'approche: Fichier de base de données

.pull-left[
  .center[
    &lt;img src="assets/img/db_flow2.png" height="450px"&gt;&lt;/img&gt;
  ]
]

.pull-right[
  - On se connecte au fichier a l'aide d'un **client** (logiciel)
  - **Avantage:** Portabilité
  - **Désavantage:** On ne peut pas se connecter à plusieurs utilisateurs en même temps.
]

&lt;!-- ---

# L'approche client-serveur

## On pourrait envisager la situation suivante...


.center[
  &lt;img src="assets/img/db_flow_multi.png" width="55%"&gt;&lt;/img&gt;
]

L'approche multi-utilisateurs peut uniquement se faire si le serveur est distant. --&gt;

---
class: inverse, center, middle

# Pratique: Du modèle conceptuel &lt;br&gt; vers le modèle informatique

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Les grandes étapes avec SQLite

1. Créer et se connecter au fichier de base de données
2. Créer les tables et spécifier les clés
3. Ajouter de l'information dans les tables
4. Faire des requêtes pour extraire l'information

---

# Se connecter au fichier la BD (SQLite3) via R




```r
# install.packages('RSQLite')
library(RSQLite)
con &lt;- dbConnect(SQLite(), dbname="./assets/data/reseau.db")
## !ATTENTION!: Ceci est mon chemin d'accès vers le fichier!
## Astuces: getwd() et setwd()
```


```r
dbSendQuery(con,"Instructions SQL à envoyer;")
```

- `con` est un objet contenant la connexion avec le serveur/fichier de base de données.
- On utilisera la fonction `dbSendQuery()` pour envoyer les instructions SQL.
- Le deuxième argument de la fonction `dbSendQuery()` est une chaine de caractères contenant les instructions SQL.

---

# Création d'une première table avec clé primaire

.pull-left[
  Voici un exemple d'instruction SQL pour créer la table `auteurs`.

.font90[
```sql
CREATE TABLE auteurs (
    auteur      VARCHAR(50),
    statut      VARCHAR(40),
    institution VARCHAR(200),
    ville       VARCHAR(40),
    pays        VARCHAR(40),
    PRIMARY KEY (auteur)
);
```
]
]

.pull-right[
- `auteurs` est le nom de la table
- Chaque attribut de la table (`auteur`,`statut` etc) dispose d'un type de données (`varchar(40)`,`DATE`,  etc) [Type de données SQLite](https://www.sqlite.org/datatype3.html)
- La dernière ligne correspond aux contraintes de la table telle que la clé primaire.
- **Question:** Cette clé primaire est composite ou simple?
]

---

# Création d'une table avec clé étrangère

.pull-left[
  Maintenant il faut créer une table `collaborations` et référencer cette table à la table `auteurs` ainsi qu'à la table `articles`.
]

.pull-right[
- On déclare `auteur1`, `auteur2` et `articleID` comme étant la clé primaire de la table `collaborations`.
- On référence ces trois attributs comme étant la clé étrangère.
]

.font90[
```sql
CREATE TABLE collaborations (
    auteur1     VARCHAR(40),
    auteur2     VARCHAR(40),
    articleID   VARCHAR(20),
    PRIMARY KEY (auteur1, auteur2, articleID),
    FOREIGN KEY (auteur1) REFERENCES auteurs(auteur),
    FOREIGN KEY (auteur2) REFERENCES auteurs(auteur),
    FOREIGN KEY (articleID) REFERENCES articles(articleID)
);
```
]

---

# Ajout de contraintes à une table

La dernière table pour les `articles`.

```sql
CREATE TABLE articles (
  articleID   VARCHAR(20) NOT NULL,
  titre       VARCHAR(200) NOT NULL,
  journal     VARCHAR(80),
  annee       DATE,
  citations   INTEGER CHECK(annee &gt;= 0),
  PRIMARY KEY (articleID)
);
```

- On peut rajouter des contraintes sur la saisie, comme CHECK qui assure que ce sont des entiers positifs
- Note : les contraintes `NOT NULL` sur la clé primaire ne sont pas obligées d'être définis.

---

# Création d'une table avec R

## On se sert de R pour envoyer l'instruction SQL de création de la table:


```r
auteurs_sql &lt;- '
CREATE TABLE auteurs (
  auteur      VARCHAR(50),
  statut      VARCHAR(40),
  institution VARCHAR(200),
  ville       VARCHAR(40),
  pays        VARCHAR(40),
  PRIMARY KEY (auteur)
);'

dbSendQuery(con, auteurs_sql)
dbListTables(con)
```

---

# Modifier la table existante

```sql
ALTER TABLE database_name.table_name RENAME TO new_table_name;
ALTER TABLE database_name.table_name ADD COLUMN column_def...;
```

Il peut être parfois préférable supprimer la table et de la reconstruire plutôt que de la modifier à la volée.

---

# Supprimer la table de données


```r
dbSendQuery(con,"DROP TABLE auteurs;")
```

- `DROP TABLE` supprime l'ensemble de la table et ses données.

---

# Supprimer la base de données


```r
dbSendQuery(con,"DROP DATABASE reseau;")
dbDisconnect(con)
```

- `DROP DATABASE` fonctionne seulement avec d'autres SGBDs (approche serveur).
- Dans le cas de SQLite3, on supprime simplement le fichier `*.db`.
- `dbDisconnect(con)` permet de fermer la connection avec le fichier de base de données (permet à un autre utilisateur de se connecter).

---

# Lectures et travail pour la semaine prochaine

## Travail

- Maintenant que vous en savez plus sur le format des données, vous devez écrire le script R pour créer votre base de données en spécifiant les tables, les champs et les clés liant les tables entre elles.

- Commencez à récolter les données

---

# Lectures et travail pour la semaine prochaine

## Travail

- Poisot et al. 2014. Moving toward a sustainable ecological science: don't let data go to waste ! Ideas in Ecology and Evolution 6: 11-19
- Mills et al. 2015. Archivin Primary Data: Solutions for Long-term Studies. Trends in Ecology and Evolution.






---
class: inverse

---
class: title-slide, middle

&lt;style type="text/css"&gt;
  .title-slide {
    background-image: url('../assets/img/bg.jpg');
    background-color: #23373B;
    background-size: contain;
    border: 0px;
    background-position: 600px 0;
    line-height: 1;
  }
&lt;/style&gt;

# Séance 3

&lt;hr width="65%" align="left" size="0.3" color="orange"&gt;&lt;/hr&gt;

## La gestion des données biologiques

&lt;hr width="65%" align="left" size="0.3" color="orange" style="margin-bottom:40px;" alt="@Martin Sanchez"&gt;&lt;/hr&gt;

.instructors[
  **BIO500** - Dominique Gravel
]

&lt;img src="../assets/img/logo.png" width="8%" style="margin-top:20px;"&gt;&lt;/img&gt;

---

# Les grandes étapes

1. Spécifier la connexion avec le serveur
2. Créer la base de données
3. Créer les tables et spécifier les clés
4. Ajouter de l'information dans les tables
5. Faire des requêtes pour extraire l'information

---
class: inverse, center, middle

# Retour rapide sur la séance de la &lt;br&gt; semaine dernière

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Connexion au serveur





```r
# install.packages('RSQLite')
library(RSQLite)

con &lt;- dbConnect(SQLite(), dbname="./assets/data/reseau.db")

tbl_auteurs &lt;- "
CREATE TABLE auteurs (
  auteur      VARCHAR(50),
  statut      VARCHAR(40),
  institution VARCHAR(200),
  ville       VARCHAR(40),
  pays        VARCHAR(40),
  PRIMARY KEY (auteur)
);"

dbSendQuery(con, tbl_auteurs)
```

**Question:** Sur ce script, où sont les instructions SQL? Òu sont les commandes R?

---

# Création de la table `auteurs`


```r
tbl_auteurs &lt;- "
CREATE TABLE auteurs (
  auteur      VARCHAR(50),
  statut      VARCHAR(40),
  institution VARCHAR(200),
  ville       VARCHAR(40),
  pays        VARCHAR(40),
  PRIMARY KEY (auteur)
);"

dbSendQuery(con, tbl_auteurs)
```

---

# Création de la table `articles`



```r
tbl_articles &lt;- "
CREATE TABLE articles (
articleID   VARCHAR(20) NOT NULL,
titre       VARCHAR(200) NOT NULL,
journal     VARCHAR(80),
annee       DATE,
citations   INTEGER CHECK(annee &gt;= 0),
PRIMARY KEY (articleID)
);"

dbSendQuery(con, tbl_articles)
```

---

# Création de la table `collaborations`



```r
tbl_collaborations &lt;- "
CREATE TABLE collaborations (
  auteur1     VARCHAR(40),
  auteur2     VARCHAR(40),
  articleID   VARCHAR(20),
  PRIMARY KEY (auteur1, auteur2, articleID),
  FOREIGN KEY (auteur1) REFERENCES auteurs(auteur),
  FOREIGN KEY (auteur2) REFERENCES auteurs(auteur),
  FOREIGN KEY (articleID) REFERENCES articles(articleID)
);"

dbSendQuery(con, tbl_collaborations)
```

---
class: inverse, center, middle

# Ajouter de l'information dans les tables

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# RSQLite - `dbWriteTable`

La librairie RSQLite peut nous aider plus facilement à accomplir cette tâche:

.font80[

```r
# Lecture des fichiers CSV
bd_auteurs &lt;- read.csv(file = './assets/data/db_reseau/authors.csv')
bd_articles &lt;- read.csv(file = './assets/data/db_reseau/articles.csv')
bd_collab &lt;- read.csv(file = './assets/data/db_reseau/collaboration.csv')

# Injection des enregistrements dans la BD
dbWriteTable(con, append = TRUE, name = "auteurs", value = bd_auteurs, row.names = FALSE)
dbWriteTable(con, append = TRUE, name = "articles", value = bd_articles, row.names = FALSE)
dbWriteTable(con, append = TRUE, name = "collaborations", value = bd_collab, row.names = FALSE)
```
]

---

# Exercice 1

Ce premier exercice est important pour la suite de la séance.

1. Recréer la base de données `reseau` avec ses trois tables `auteurs`, `articles` et `collaborations`
2. Insérer les données [auteurs.csv](https://raw.githubusercontent.com/EcoNumUdS/BIO500/master/bloc1/assets/data/db_reseau/authors.csv), [collaborations.csv](https://raw.githubusercontent.com/EcoNumUdS/BIO500/master/bloc1/assets/data/db_reseau/collaboration.csv) et [articles.csv](https://raw.githubusercontent.com/EcoNumUdS/BIO500/master/bloc1/assets/data/db_reseau/articles.csv) dans les deux tables à l'aide de la commande R `dbWriteTable()`


---
class: inverse, center, middle

# Les requêtes

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Structure du requête

.font70[
.pull-left[
```sql
SELECT colonnes/champs
FROM table1
JOIN table2 ON table1.foreignKey = table2.primaryKey
WHERE criteres
ORDER BY colonne1 ASC
LIMIT 10;
```
]]

.pull-right[
- Les requêtes SQL sont une suite d'opérations séquentielles.
- On ne peut pas filtrer (`WHERE`) avant que les opérations `SELECT`, `FROM` et `JOIN` soit complétées.
]

---

# Sélectionner des tables et des colonnes

## La connexion est ouverte et toujours accessible depuis l'objet `con`.

.pull-left[
.font90[

```r
sql_requete &lt;- "
SELECT articleID, journal, annee
  FROM articles LIMIT 10
;"

articles &lt;- dbGetQuery(con, sql_requete)
head(articles)
```
]]

.pull-right[
- `SELECT` spécifie les colonnes.
- `FROM` spécifie la table.
- On peut également ajouter une `LIMIT`.
- [Documentation SQL Select](http://docs.postgresqlfr.org/9.5/sql-select.html).
]


```
##        articleID                               journal annee
## 1 Brousseau2018b                    Functional Ecology  2018
## 2     Laigle2018                                 Oikos  2018
## 3   grossman2018 Environmental and Experimental Botany  2018
## 4     delmas2019                    Biological Reviews  2019
## 5  legagneux2018    Frontiers in Ecology and Evolution  2018
## 6     godsoe2018       Trends in ecology \\&amp; evolution  2018
```
---

# Sélectionner des tables et des colonnes

.font90[
.pull-left[

```r
sql_requete &lt;- "SELECT *
FROM collaborations LIMIT 10;"

articles &lt;- dbGetQuery(con, sql_requete)
head(articles)
```
]]

.pull-right[
.font90[
- `*` permet de ne pas spécifier une colonne en particulier.
- Cette requête retournera toutes les colonnes de la table `collaborations`
- Note: L'instruction `LIMIT` est utilisée dans les prochaines diapos afin de permettre le rendu des requêtes sur une diapo.
]]


```
##                 auteur1               auteur2      articleID
## 1      Dominique Gravel Pierre-Marc Brousseau Brousseau2018b
## 2        I. Tanya Handa Pierre-Marc Brousseau Brousseau2018b
## 3 Pierre-Marc Brousseau      Dominique Gravel Brousseau2018b
## 4        I. Tanya Handa      Dominique Gravel Brousseau2018b
## 5 Pierre-Marc Brousseau        I. Tanya Handa Brousseau2018b
## 6      Dominique Gravel        I. Tanya Handa Brousseau2018b
```

---

# Sélectionner des enregistrements unique

.font80[
.pull-left[

```r
sql_requete &lt;- "SELECT DISTINCT auteur1
FROM collaborations LIMIT 10;"

auteurs &lt;- dbGetQuery(con, sql_requete)
head(auteurs)
```

```
##                    auteur1
## 1          Aitor Ameztegui
## 2           Alain Paquette
## 3        Aleksi Lehikoinen
## 4 Alessandro Montemaggiori
## 5            Alicia McGrew
## 6         Alison D. Munson
```
]]

.pull-right[
- L'instruction `DISTINCT` permettra de retourner des noms présent dans la table auteurs.
]

---

# Ordonner la table

.font80[
.pull-left[

```r
sql_requete &lt;- "
SELECT annee, citations, articleID
  FROM articles ORDER BY citations DESC
;"
derniers_articles &lt;- dbGetQuery(con, sql_requete)
head(derniers_articles)
```
]]

.pull-right[
- `ORDER BY` permet de trier par ordre croissant (`ASC`) ou décroissant (`DESC`).
]


```
##   annee citations      articleID
## 1  2019        59     delmas2019
## 2  2018        30   grossman2018
## 3  2018        28  legagneux2018
## 4  2018        21 Brousseau2018b
## 5  2018        21     Laigle2018
## 6  2018        21    galiana2018
```

---

# Critères avec `NULL`

.font80[
.pull-left[

```r
sql_requete &lt;- "
SELECT auteur, statut, institution
  FROM auteurs WHERE statut IS NOT NULL
;"
auteurs &lt;- dbGetQuery(con, sql_requete)
head(auteurs)
```

```
##                auteur    statut               institution
## 1    Dominique Gravel Professor  Universite de Sherbrooke
## 2      Isabelle Aubin Professor  Natural Resources Canada
## 3 Isabelle Boulangeat Professor Universite Grenoble Alpes
## 4          Eva Delmas   Student    Universite de Montreal
## 5     Mathilde Besson   Student    Universite de Montreal
## 6  Marie-Hélène Brice   Student    Universite de Montreal
```
]]

.pull-right[
.font90[
- `WHERE`, spécifie les critères de la requête.
- `statut IS NULL` permet d'obtenir seulement les auteurs n'ayant pas de statut.
]]

---

# Combiner les critères

.font80[
.pull-left[

```r
sql_requete &lt;- "
SELECT articleID, annee
  FROM articles WHERE
  (annee &gt;= 2018 AND annee &lt; 2020)
  OR (annee &gt;= 2012 AND annee &lt;= 2014)
  ORDER BY annee
;"
articles &lt;- dbGetQuery(con, sql_requete)
head(articles)
```

```
##        articleID annee
## 1 Brousseau2018b  2018
## 2     Laigle2018  2018
## 3   grossman2018  2018
## 4  legagneux2018  2018
## 5     godsoe2018  2018
## 6    galiana2018  2018
```
]]

.pull-right[
- Multi-critères avec `AND` et `OR`
- Les parenthèses définissent les priorités d'opérations.
- Opérateurs de comparaison: `&gt;=`,`&lt;=`, `=` (Valeurs numériques)
- [Documentation sur les opérateurs de comparaisons](https://www.sqlite.org/lang_expr.html)
]

---

# Critères sur le texte avec `LIKE`

.font80[
.pull-left[

```r
sql_requete &lt;- "
SELECT articleID, titre
  FROM articles WHERE titre LIKE '%interactions%'
;"
articles &lt;- dbGetQuery(con, sql_requete)
head(articles)
```

```
##        articleID
## 1 Brousseau2018b
## 2     delmas2019
## 3       mora2018
## 4 boulangeat2018
## 5  Eitzeiger2018
## 6   Aussenac2019
##                                                                                                                                titre
## 1                                  Trait matching and phylogeny as predictors of predator-prey interactions involving ground beetles
## 2                                                                              Analysing ecological networks of species interactions
## 3                                       Identifying a common backbone of interactions underlying food webs from different ecosystems
## 4                                        The transient response of ecosystems to climate change is amplified by trophic interactions
## 5 Assessing changes in arthropod predator–prey interactions through DNA-based gut content analysis—variable environment, stable diet
## 6                            Interactions among trees: A key element in the stabilising effect of species diversity on forest growth
```
]]

.pull-right[
- Rechercher dans le texte: `LIKE`
- `%`: n'importe quels caractères
- `_`: un seul caractère (exemple: `_1_` peut renvoyer `113` ou encore `A1C`)
- Le critère contraire est aussi possible avec `NOT` (exemple: `WHERE titre NOT LIKE '%interactions%'`)
]

---

# Exercice 2

Dans ta table `auteurs`, essayez de trouver les auteurs dont l'institution est `Universite de Sherbrooke`.

---

# Agréger l'information (1 ligne)

.font80[
.pull-left[

```r
sql_requete &lt;- "
SELECT avg(citations) AS moyenne,
  min(citations), max(citations)
  FROM articles;"

resume_articles &lt;- dbGetQuery(con, sql_requete)
head(resume_articles)
```

```
##    moyenne min(citations) max(citations)
## 1 10.23529              0             59
```
]]

.pull-right[
- Pour faire une synthèse de l'information sur une seule ligne.
- Faire des opérations sur les champs numériques: `max`, `min`, `sum`, `avg`, `count`.
- Mais aussi les opérations classiques: `*`, `/`, `-` etc.
- Renommer les colonnes avec `AS`.
]

---

# Agréger l'information

## plusieurs lignes par groupe

.font80[
.pull-left[

```r
sql_requete &lt;- "
SELECT avg(citations) AS moyenne,
count(articleID) AS nb_articles, annee
  FROM articles
  GROUP BY annee;"

resume_articles &lt;- dbGetQuery(con, sql_requete)
head(resume_articles)
```

```
##     moyenne nb_articles annee
## 1 12.000000          15  2018
## 2  8.842105          19  2019
```
]]

.pull-right[
- `COUNT` permet de dénombrer le nombre de lignes.
- `GROUP BY` définit les champs sur lequel se fera l'agrégation des données.
]

---

# Exercice 3

À l'aide de la base de données `reseau`, dénombrer le nombre de collaborations par auteur.

Quel est l'auteur qui a le plus de collaborations ?

---
class: inverse, center, middle

# Jointures entre tables

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Jointures entre tables

Le `INNER JOIN` est un type de jointure, renvoyant seulement les auteurs et les articles ayant un identifiant `id_film` commun.


```r
sql_requete &lt;- "
SELECT annee, auteur1, auteur2, journal, articles.articleID
  FROM articles
  INNER JOIN collaborations ON articles.articleID = collaborations.articleID
  ;"

auteurs_articles &lt;- dbGetQuery(con,sql_requete)
head(auteurs_articles,4)
```

```
##   annee               auteur1               auteur2            journal
## 1  2018      Dominique Gravel Pierre-Marc Brousseau Functional Ecology
## 2  2018        I. Tanya Handa Pierre-Marc Brousseau Functional Ecology
## 3  2018 Pierre-Marc Brousseau      Dominique Gravel Functional Ecology
## 4  2018        I. Tanya Handa      Dominique Gravel Functional Ecology
##        articleID
## 1 Brousseau2018b
## 2 Brousseau2018b
## 3 Brousseau2018b
## 4 Brousseau2018b
```
---

# Les type de jointures

.center[
  &lt;img src="assets/img/sql_joins.png" width="80%"&gt;&lt;/img&gt;
]

---

# Jointures entre tables

On peut spécifier la jointure avec `USING` seulement si les deux clés possèdent le même nom.


```r
sql_requete &lt;- "
SELECT annee, auteur1, auteur2, journal, articles.articleID
  FROM articles
  INNER JOIN collaborations USING (articleID)
  ;"

auteurs_articles &lt;- dbGetQuery(con,sql_requete)
head(auteurs_articles,4)
```

```
##   annee               auteur1               auteur2            journal
## 1  2018      Dominique Gravel Pierre-Marc Brousseau Functional Ecology
## 2  2018        I. Tanya Handa Pierre-Marc Brousseau Functional Ecology
## 3  2018 Pierre-Marc Brousseau      Dominique Gravel Functional Ecology
## 4  2018        I. Tanya Handa      Dominique Gravel Functional Ecology
##        articleID
## 1 Brousseau2018b
## 2 Brousseau2018b
## 3 Brousseau2018b
## 4 Brousseau2018b
```

---

# Exercice 4

## Quel article a le plus d'auteurs ?

---

# Requêtes emboitées

.font70[
.pull-left[

```r
sql_requete &lt;- "
SELECT auteur1, avg(citations) AS moy_citations FROM (
  SELECT auteur1, articleID, citations
    FROM articles
    INNER JOIN collaborations USING (articleID)
) GROUP BY auteur1;"

moy_auteurs &lt;- dbGetQuery(con,sql_requete)
head(moy_auteurs)
```

```
##                    auteur1 moy_citations
## 1          Aitor Ameztegui             4
## 2           Alain Paquette            30
## 3        Aleksi Lehikoinen            19
## 4 Alessandro Montemaggiori             0
## 5            Alicia McGrew             6
## 6         Alison D. Munson             2
```
]]

.pull-right[
- On s'interroge sur le nombre moyen de citations par auteur.
- Pour ce faire, on peut bâtir une requête à partir d'une autre requête.
]

---

# Exercice 5

## Est-ce que le nombre de citations est proportionnel au nombre de collaborateurs par article ?

---

# Filtrer les requêtes à posteriori

.font70[
.pull-left[

```r
sql_requete &lt;- "
SELECT auteur1, avg(citations) AS moy_citations FROM (
  SELECT auteur1, articleID, citations
    FROM articles
    INNER JOIN collaborations USING (articleID)
) GROUP BY auteur1
HAVING moy_citations &gt; 10;"

moy_auteurs &lt;- dbGetQuery(con,sql_requete)
head(moy_auteurs)
```

```
##             auteur1 moy_citations
## 1    Alain Paquette            30
## 2 Aleksi Lehikoinen            19
## 3   Andreas Schuldt            30
## 4       Andy Hector            30
## 5      Anna Norberg            19
## 6    Antoine Guisan            19
```
]]

.pull-right[
- Il est possible de filtrer à posteriori sur la requête avec `HAVING`.
]


---
class: inverse, center, middle

# Sauvegarder les requêtes

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Sauvegarder une requête

Afin de sauvegarder les requêtes obtenues dans R par `dbGetQuery()`, il est possible d'utiliser les fonctions d'écritures tels que `write.table()` ou encore `write.csv()`.

---
class: inverse, center, middle

# Manipuler les enregistrements

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Mettre à jour des enregistrements

On peut mettre à jour des enregistrements d'une table avec des critères spécifiques.

```sql
UPDATE auteurs SET institution = 'UdeS' WHERE institution = 'Universite de Sherbrooke';
```

**Note:** On ne peut pas faire de modifications d'enregistrements sur des requêtes, seulement sur les tables directement.

[Documentation sur la commande UPDATE](http://docs.postgresqlfr.org/8.3/sql-update.html)


---

# Supprimer des enregistrements

On peut supprimer des enregistrements d'une table avec des critères spécifiques.

```sql
DELETE FROM auteurs WHERE ville &lt;&gt; 'Montreal';
```

Ou sans critères, pour supprimer tous les enregistrements.

```sql
DELETE FROM auteurs;
```

[Documentation sur la commande DELETE](http://docs.postgresqlfr.org/8.3/sql-delete.html)

---
class: inverse, center, middle

# Travail de la semaine

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;

---

# Travail de la semaine

0. Uniformiser les tables des différentes équipes (en script)

1. Créer la base de données

2. Injecter les données

3. Faire les requêtes suivantes :
  - Nombre de liens par étudiant
  - Décompte de liens par paire d'étudiants

4. Enregistrer le résultat des requêtes dans un fichier csv

---

# Travail de la semaine

5. En post-traitement sur R :
  - Calculer le nombre d'étudiants, le nombre de liens et la connectance du réseau
  - Calculer le nombre de liens moyens par étudiant et la variance

6. Écrire un script qui réalise les étapes 0-3 d'un bloc

Assurez vous que le script fonctionne sur l'ordinateur du laboratoire et également entre des utilisateurs différents.

---

# Lectures

## Débat sur le partage des données

- Poisot et al. 2014. Moving toward a sustainable ecological science: don't let data go to waste ! Ideas in Ecology and Evolution 6: 11-19
- Mills et al. 2015. Archiving Primary Data: Solutions for Long-term Studies. Trends in Ecology and Evolution.

---
class: inverse, center, middle

# Discussion

&lt;hr width="65%" size="0.3" color="orange" style="margin-top:-20px;"&gt;&lt;/hr&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../assets/macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "monokai",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
